<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE concept PUBLIC "urn:pubid:dita4publishers.org:doctypes:dita:concept" "urn:pubid:dita4publishers.org:doctypes:dita:concept">
<concept id="conceptId">
 <title>Numbering Things: Collected Data and Enumeration</title>
 <shortdesc>How to use the collected enumeration data to number things in
    output.</shortdesc>
  <prolog>
    <metadata>
      <keywords>
        <indexterm>enumeration</indexterm>
        <indexterm>numbering</indexterm>
        <indexterm>collected data<indexterm/></indexterm>
        <indexterm></indexterm>
      </keywords>
    </metadata>
  </prolog>
 <conbody>
   <p>The collected data includes data specifically designed to make numbering
      (enumeration) easy. The enumeration structure reflects the entire
      publication (root map) and contains the minimum amount of structure and
      data needed to number things, generate navigation lists, resolved cross
      references, and so on. This includes all topics, figures and tables with
      titles, sections, examples, and all div-type elements
      (<xmlelement>bodydiv</xmlelement>, <xmlelement>sectiondiv</xmlelement>,
      <xmlelement>div</xmlelement>).</p>
    <p>The XML structure of the enumeration data looks like
      this:<codeblock>&lt;mapdriven:collected-data xmlns:mapdriven="http://dita4publishers.org/mapdriven"
                          xmlns:index-terms="http://dita4publishers.org/index-terms"
                          xmlns:enum="http://dita4publishers.org/enumerables">
   <b>&lt;enum:enumerables></b>
      &lt;frontmatter xmlns="http://dita4publishers.org/enumerables"
                   class="+ map/topicref pubmap-d/frontmatter "
                   sourceId="-frontmatter-22-110-121"
                   xtrc="frontmatter:1"
                   docUri="file:/Users/ekimber/workspace/ebook-conversion/dita/temp/epub/Tax-Preparation.ditamap">
         &lt;inside-front-cover class="+ map/topicref pubmap-d/inside-front-cover "
                             sourceId="-inside-front-cover-23-118-52"
                             xtrc="inside-front-cover:1"
                             docUri="file:/Users/ekimber/workspace/ebook-conversion/dita/temp/epub/Tax-Preparation.ditamap">
            &lt;title>Front Cover&lt;/title>
         &lt;/inside-front-cover>
         &lt;preface class="+ map/topicref pubmap-d/preface "
                  sourceId="-preface-30-112-69"
                  xtrc="preface:1"
                  docUri="file:/Users/ekimber/workspace/ebook-conversion/dita/temp/epub/Tax-Preparation.ditamap">
            &lt;title>Copyright Page&lt;/title>
         &lt;/preface>
      &lt;/frontmatter>
      ...
    <b>&lt;/enum:enumerables></b>
    ...
&lt;/mapdriven:collected-data></codeblock></p>
    <p>The <xmlelement>enum:enumerables</xmlelement> reflects the hierarchical
      structure of the publication. Each element reflects its DITA
      <xmlatt>class</xmlatt> value, the URI of the source document it came from,
      and its "source ID", which is a unique identifier for the element
      constructed from its original context. The source ID is generated by the
      DITA utilities function <keyword>df:generate-dita-id()</keyword>.</p>
    <p>To number an element in output processing, you generate the source ID for
      the element you want to number, then apply templates to the element that
      has that ID within the enumerables data in the mode
      <keyword>enumeration</keyword>, as in this fragment for numbering
      figures:<codeblock>  ...
  <b>&lt;xsl:variable name="sourceId" select="df:generate-dita-id(.)" as="xs:string"/></b>
  &lt;span class="figcap">
    <b>&lt;xsl:apply-templates select="$collected-data/enum:enumerables//*[@sourceId = $sourceId]"</b>
      <b>mode="enumeration"/></b>
      &lt;xsl:apply-templates select="*[contains(@class,' topic/title ')]" mode="figtitle"/>
  &lt;/span>
  ...</codeblock></p>
    <p>In the mode enumeration you provide templates that implement your
      numbering rules,
      e.g.:<codeblock>  &lt;xsl:template mode="enumeration"  match="*[df:class(., 'topic/fig')][enum:title]">
    &lt;!-- Context item should be enum:* from the collected-data 
        
         NOTE: Within the collected data, all titles are normalized
         to enum:title with no @class attribute.
    -->
    &lt;span class="enumeration fig-enumeration">
      &lt;xsl:text>Figure &lt;/xsl:text>      
      &lt;xsl:number count="*[df:class(., 'topic/fig')][enum:title]"
        level="any"
        format="1."
      />
      &lt;xsl:text>&amp;#xa0;&lt;/xsl:text>
    &lt;/span>
  &lt;/xsl:template></codeblock></p>
    <p>Note that in this template, the usual <xmlelement>xsl:number</xmlelement>
      facility is used to number the figure. Because the enumeration data
      reflects the entire publication you can number figures across the entire
      publication, as in this example. Because the enumeration data also
      includes all the topic and topicheads in their map-defined hierarchy, you
      could also number things at a part, chapter, or other level, as long as
      it's provided for in the enumeration structure.</p>
 </conbody>
</concept>
